function n(e,t){return(t||document).querySelector(e)}const r=(e,t,s,i)=>{e.addEventListener(t,s,!!i)},$=(e,t,s,i)=>{e.removeEventListener(t,s,!!i)},b=n("[data-user-menu]"),M=n("[data-user]");function C(){b.classList.toggle("hidden")}r(document,"mouseup",({target:e})=>{e!==M&&b.classList.add("hidden")});r(M,"click",C);const f={method:"GET",headers:{accept:"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJlMGI1NDAxZjVmNGZkMjRiOTJkYmMyOGVkYmJmMWU5MyIsInN1YiI6IjY1ZjVmYTgwODFkYTM5MDE4NjYxNTJjZSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.3UWDsNuJsyGQ_UQSFZ7Hkq0UqcvOMmQwwKpVnE_8jaw"}},H="https://image.tmdb.org/t/p/",I={sm:"w300",md:"w780",lg:"w1280",og:"original"};async function j(e){return(await fetch(`https://api.themoviedb.org/3/movie/${e}?language=en-US`,f)).json()}function v(e,t){return e===null?"None":H+I[t||"md"]+e}function z(e){return e.cast.filter(s=>s.known_for_department==="Acting")}function N(e){if(!e||e.length===0)return"None";const t=e.find(i=>i.iso_3166_1==="US");if(!t||!t.release_dates||t.release_dates.length===0)return"None";const s=t.release_dates.find(i=>i.certification!=="");return s?s.certification:"None"}class J{constructor(){this.$=n("[data-overview]"),this.$img=n("[data-overview-img]"),this.$trailer=n("[data-overview-trailer]"),this.$likes=n("[data-overview-likes]"),this.$year=n("[data-overview-year]"),this.$rating=n("[data-overview-rating]"),this.$duration=n("[data-overview-duration]"),this.$description=n("[data-overview-description]"),this.$cast=n("[data-overview-cast]"),this.$categories=n("[data-overview-categories]"),this.$morelike=n("[data-overview-morelike]"),this.$watchlist=n("[data-add-to-watchlist-overview]"),this.lastMovieId}toggle(t,s){t&&(this.lastMovieId!==s&&this.empty(),this.$.classList.add("overview--show"),this.update(s)),t||this.$.classList.remove("overview--show")}async update(t){setTimeout(async()=>{const s=o=>`https://image.tmdb.org/t/p/original/${o}`,a=await(await fetch(`https://api.themoviedb.org/3/movie/${t}?append_to_response=videos%2Cimages%2Ccredits%2Crelease_dates%2Csimilar&language=en`,f)).json(),m=a.videos.results.find(o=>o.type=="Trailer");if(m!==void 0){const o=`https://youtu.be/${m.key}`;this.setTrailer(o)}else this.setTrailer(!1);a.images.backdrops[0]!=null?this.setImg(s(a.images.backdrops[0].file_path),"Movie poster"):this.setImg(s(a.backdrop_path),"Movie Poster"),this.setLikes(Math.round(a.vote_average)/10*100),this.setYear(new Date(a.release_date).getFullYear()),this.setRating(N(a.release_dates.results)),this.setDescription(a.overview),this.setCast(z(a.credits).map(o=>o.name).slice(0,3)),this.setCategories(a.genres.map(o=>o.name)),this.setMorelike(a.similar.results),this.setDuration(a.runtime),this.setId(a.id),this.lastMovieId=t},400)}setId(t){this.$watchlist.id=t,this.$watchlist.classList.remove("disabled")}setImg(t,s){this.$img.src=t,this.$img.alt=s}setTrailer(t){this.$trailer.href=t}setLikes(t){this.$likes.textContent=`${t}%`}setYear(t){this.$year.textContent=t}setRating(t){this.$rating.textContent=t}setDuration(t){const s=Math.floor(t/60),i=t%60;t={hours:s,remainingMinutes:i},this.$duration.textContent=`${t.hours}h ${t.remainingMinutes}m`}setDescription(t){this.$description.textContent=t}setCast(t){this.$cast.innerHTML="",t.forEach((s,i)=>{if(i===0)return this.$cast.innerHTML+=`<span class="text-zinc-500">Cast: </span>${s}, `;if(i===t.length-1)return this.$cast.innerHTML+=`${s} and <i>more</i>`;this.$cast.innerHTML+=`${s}, `})}setCategories(t){this.$categories.innerHTML="",t.forEach((s,i)=>{if(i===0)return this.$categories.innerHTML+=`<span class="text-zinc-500">Genres: </span>${s}, `;if(i===t.length-1)return this.$categories.innerHTML+=`${s}`;this.$categories.innerHTML+=`${s}, `})}setMorelike(t){t=t.filter(s=>s.backdrop_path!==null).slice(0,3),this.$morelike.innerHTML="",t.forEach(s=>{this.$morelike.innerHTML+=`
      <div id="${s.id}" data-overview-morelike-preview class="cursor-pointer group">
        <div class="max-h-36 pointer-events-none aspect-video bg-zinc-800 rounded-md overflow-hidden mb-2 group-hover">
          <img src="https://image.tmdb.org/t/p/original/${s.backdrop_path}" alt="${s.title}" class="transition-all saturate-50 group-hover:saturate-100 mb-2 h-full pointer-events-none" />
        </div>
        <p class="truncate max-w-[250px] group-hover:text-rose-300 transition text-[clamp(8px,1.5vw,1rem)] pointer-events-none">${s.title}</p>
      </div>`})}empty(){this.$img.src="",this.$img.alt="",this.$trailer.href="",this.$likes.textContent="70%",this.$year.textContent="2024",this.$rating.textContent="R",this.$duration.textContent="1h 30m",this.$description.innerHTML="";for(let t=0,s=3;t<s;t++)this.$description.innerHTML+='<div class="skeleton description--skeleton"></div>';this.$cast.innerHTML="",this.$categories.innerHTML="",this.$morelike.innerHTML="";for(let t=0,s=3;t<s;t++)this.$morelike.innerHTML+=`<div data-overview-morelike-preview class="aspect-video skeleton max-h-36 rounded-md overflow-hidden bg-zinc-800 cursor-pointer">
          <img src="" alt="" class="mb-2 h-full pointer-events-none" />
          <p class="h-4 truncate max-w-[250px]"></p>
        </div>`;this.$watchlist.classList.add("disabled")}}const p=new J;p.toggle(!0);class O{constructor(){this.$=n("[data-loading]")}show(t){this.$.classList.add("show-loading"),this.$.textContent=t}hide(t){t&&(this.$.textContent=t),setTimeout(()=>{this.$.classList.remove("show-loading")},500)}message(t){this.show(t),this.hide()}}const d=new O,L=n("[data-carousels]");let h,w={l:0,x:0};function A({target:e,pageX:t}){h=e.closest("[data-carousel]"),h!==null&&(w={l:h.scrollLeft,x:t-h.offsetLeft},r(document,"mousemove",y),r(document,"mouseup",T))}function y({pageX:e}){const i=(e-h.offsetLeft-w.x)*2;h.scrollLeft=w.l-i}function T(){$(document,"mousemove",y),$(document,"mouseup",T)}async function D(e){if(e.target.matches("[data-play]"))return await E(e);e.target.matches("[data-link]")&&(e.preventDefault(),p.toggle(!0,e.target.id))}async function E(e){d.show("Loading"),e.preventDefault();const t=await fetch(`https://api.themoviedb.org/3/movie/${e.target.id}/videos`,f),{results:s}=await t.json(),i=s?.filter(a=>a.type=="Trailer");try{window.open(`https://youtu.be/${i[0].key}`,"_blank"),d.hide()}catch(a){console.log(a)}}r(L,"mousedown",A);r(L,"click",D);const c=n("input"),_=()=>c.value==="",g=n("[data-results]"),u={$:n("[data-results]"),isOpen:!1,hide(){this.$.style.display="none",this.isOpen=!1},show(){this.$.removeAttribute("style"),this.isOpen=!0}};function U(){if(_())return u.hide();q(c.value)}function Y(e){e.keyCode===27&&(c.value="",u.hide())}function S(){_()||u.show()}function G(e){if(g.innerHTML=null,e=R(e),e==""){const t=x(null,null,null,null);g.insertAdjacentHTML("beforeend",t)}e.forEach(t=>{const s=x(t.poster_path,t.title,t.release_date,t.id);g.insertAdjacentHTML("beforeend",s)}),u.show()}function R(e){return e?.filter(t=>t.backdrop_path&&t.hasOwnProperty("release_date")&&t.release_date!=="")}function x(e,t,s,i){let a="";return e===null&&t===null&&s===null?a=`
              <div class="text-xl flex gap-4 h-36 w-full items-center justify-center">
                  <p class="truncate">No results</p>
              </div>`:(e=v(e,"sm"),s=new Date(s).getFullYear(),a=`
              <a id="${i}" class="text-base grid grid-cols-[90px,minmax(0,1fr)] gap-4 cursor-pointer group">
                <div class="h-36 aspect-[10/16] rounded-lg overflow-hidden flex-initial">
                  <img src="${e}" alt="Movie poster" loading="lazy" class="h-full w-full saturate-[0.75] group-hover:saturate-100 transition" />
                </div>
                <div class="max-w-3/5">
                  <p class="truncate text-ellipsis group-hover:text-rose-300 transition text-[clamp(12px,2vw,1em)]">${t}</p>
                  <p class="font-light text-zinc-300 group-hover:text-zinc-500 transition text-[clamp(12px,2vw,1em)]">${s}</p>
                </div>
              </a>`),a}async function W(e){const t=await fetch(`https://api.themoviedb.org/3/search/movie?query=${e}&include_adult=false&language=en-US&page=1`,f),{results:s}=await t.json();G(s)}function Z(e,t){let s;return(...i)=>{clearTimeout(s),s=setTimeout(()=>{e.apply(this,i)},t)}}const q=Z(W,300);r(document,"mouseup",({clientX:e,clientY:t})=>{const{left:s,right:i,top:a,bottom:m}=u.$.getBoundingClientRect();document.activeElement!==c&&(e<s||e>i||t<a||t>m)&&u.hide()});r(g,"click",e=>{const t=e.target.closest("a").id;p.toggle(!0,t)});r(c,"focus",S);r(c,"keydown",Y);r(c,"input",U);r(n("[data-overview-close]"),"click",()=>p.toggle(!1));r(n("[data-overview-morelike]"),"click",e=>{e.target.matches("[data-overview-morelike-preview]")&&p.toggle(!0,+e.target.id)});const B='<svg class="h-full w-full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M9.9997 15.1709L19.1921 5.97852L20.6063 7.39273L9.9997 17.9993L3.63574 11.6354L5.04996 10.2212L9.9997 15.1709Z"></path></svg>';class Q{constructor(){this.watchlist=this.load()||[],this.$watchlist=n("[data-watchlist]"),this.$container=n("[data-watchlist-container]"),this.render()}open(){this.render(),this.$container.classList.remove("hidden")}close(){this.$container.classList.add("hidden")}async add(t){if(this.watchlist.find(a=>a.id===t)!==void 0)return d.message("Already added");if(t==null)return d.hide("Not found");d.show("Adding");const i=await j(t);this.watchlist.push(i),i.watched=!1,this.save(),d.hide("Added")}remove(t){this.watchlist=this.watchlist.filter(s=>s.id!==t),this.save(),this.render()}markAsWatched(t,s){const i=this.watchlist.find(a=>a.id===t);i.watched=!i.watched,this.save(),this.render()}save(){localStorage.setItem("watchlist",JSON.stringify(this.watchlist))}load(){return JSON.parse(localStorage.getItem("watchlist"))}render(){if(this.$watchlist.innerHTML=null,this.watchlist.length===0)return this.$watchlist.innerHTML='<p class="text-center col-span-3 w-full text-zinc-500 mt-28">No movies added yet</p>';this.watchlist.forEach(t=>{this.$watchlist.innerHTML+=this.string(t.watched,t)})}string(t,s){const i=`
       <div data-watchlist-movie class="mb-4">
         <div class="relative aspect-video max-md:rounded-lg rounded-xl overflow-hidden bg-zinc-900 mb-2">
          <div class="absolute bg-zinc-950/80 w-full h-full flex items-center justify-center flex-col gap-2 max-sm:gap-1 font-extralight text-[clamp(10px,2vw,1rem)] text-zinc-300">
            <button data-watchlist-markaswatched class="transition flex items-center gap-1 text-lime-200" id="${s.id}">Marked as watched<span class="h-5 inline-block">${B}</span></button>
            <button data-watchlist-remove class="hover:text-zinc-50 transition" id="${s.id}">Remove</button>
          </div>
           <img src="${v(s.backdrop_path)}" alt="${s.title}" class="rounded-lg" />
         </div>
         <p id="${s.id}" class="text-center cursor-pointer hover:text-rose-300 transition text-[clamp(10px,2vw,1rem)]">${s.title}</p>
       </div>`,a=`
       <div data-watchlist-movie class="mb-4">
         <div class="relative aspect-video max-md:rounded-lg rounded-xl overflow-hidden bg-zinc-900 mb-2">
          <div class="absolute bg-zinc-950/80 w-full h-full opacity-0 hover:opacity-100 flex items-center justify-center flex-col gap-2 font-extralight text-[clamp(10px,2vw,1rem)] text-zinc-300">
            <button data-watchlist-markaswatched class="hover:brightness-110 flex items-center gap-1 transition" id="${s.id}">Mark as watched</button>
            <button data-watchlist-remove class="hover:text-zinc-50 transition" id="${s.id}">Remove</button>
          </div>
           <img src="${v(s.backdrop_path)}" alt="${s.title}" class="rounded-lg" />
         </div>
         <p data-watchlist-title id="${s.id}" class="text-center cursor-pointer hover:text-rose-300 transition text-[clamp(10px,2vw,1rem)]">${s.title}</p>
       </div>`;if(t)return i;if(!t)return a}}const l=new Q,k=n("[data-add-to-watchlist-overview]");r(document,"click",({target:e})=>{if(e.matches("[data-watchlist-title]")&&(l.close(),p.toggle(!0,e.id)),e.matches("[data-mywatchlist]")&&l.open(),e.matches("[data-watchlist-close]")&&l.close(),e.matches("[data-add-to-watchlist]")&&l.add(+e.id),e.matches("[data-watchlist-remove]")&&l.remove(+e.id),e===k){if(k.classList.contains("disabled"))return;l.add(+e.id)}if(e.matches("[data-watchlist-markaswatched]")){const t=e.closest("[data-watchlist-movie]");l.markAsWatched(+e.id,t)}});
