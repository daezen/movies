---
import Play from '../icons/Play.astro'
import Plus from '../icons/Plus.astro'
import Dot from '../components/Dot.astro'
import Likes from '../components/Likes.astro'
import Genres from '../components/Genres.astro'
import Starring from '../components/Starring.astro'
import AgeRating from '../components/AgeRating.astro'
import { randomMovie, rating, releaseYear, genres, cast, backdrop, logo } from '../../src/lib/hero.js'
---

<header class="text-xl mb-16 relative">
  <img src={backdrop('og')} loading="lazy" class="absolute h-full w-full blur-[256px] z-[-1] select-none" draggable="false" />
  <div class="image rounded-3xl overflow-hidden shadow-2xl" style=`background-image: url(${backdrop('og')});`>
    <div class="shadow">
      <section class="px-20 py-8 h-screen max-w-[950px] flex justify-center flex-col gap-5">
        <img src={logo('medium')} alt="Movie logo" class="aspect-auto max-h-96" />
        <div class="px-2 py-1 rounded-3xl">
          <div class="flex gap-3 items-center py-1 rounded-lg">
            <Likes rating={Math.round(rating)} />
            <Dot />
            <p>{releaseYear}</p>
            <Dot />
            <AgeRating age="16" />
            <Dot />
            <Genres genres={genres} />
          </div>
          <p class="leading-relaxed text-zinc-200 py-2 mb-2 rounded-lg">{randomMovie.overview}</p>
          <Starring cast={cast} amount="7" />
        </div>
        <div class="flex gap-4 mt-6">
          <button
            data-trailer
            id={randomMovie.id}
            class="relative overflow-hidden custom-hover gradient-one bg-rose-600 flex items-center justify-center gap-4 text-2xl w-64 h-[72px] py-6 rounded-full border-2 border-rose-500"
            ><Play />Play Trailer</button
          >
          <button
            class="relative overflow-hidden custom-hover gradient-two flex items-center justify-center gap-4 text-2xl w-64 h-[72px] py-5 bg-zinc-100 bg-opacity-15 rounded-full border-2 border-zinc-500 backdrop-blur-md"
            ><Plus />My Watchlist</button
          >
        </div>
      </section>
    </div>
  </div>
</header>

<style>
  .image {
    background: center / cover no-repeat;
  }
  .shadow {
    background: linear-gradient(to right, black 0%, rgba(0, 0, 0, 0.8) 25%, transparent 75%);
  }
  .custom-hover::after {
    content: '';
    @apply w-full h-full absolute transition duration-500 opacity-0;
  }
  .custom-hover:hover::after {
    @apply opacity-100;
  }
  .gradient-one::after {
    background-image: radial-gradient(farthest-corner at 50% 100%, rgba(255, 255, 255, 0.3) 0%, transparent 69%);
  }
  .gradient-two::after {
    background-image: radial-gradient(farthest-corner at 50% 100%, rgba(255, 255, 255, 0.2) 0%, transparent 69%);
  }
</style>

<script>
  import { qs, $on } from '../lib/helpers.js'
  import options from '../lib/api'
  async function findTrailer(e) {
    const res = await fetch(`https://api.themoviedb.org/3/movie/${e.target.id}/videos`, options)
    const { results: trailers } = await res.json()
    const trailer = trailers.filter(trailer => trailer.type == 'Trailer')
    try {
      window.open(`https://youtu.be/${trailer[0].key}`, '_blank')
    } catch (error) {
      console.log(error)
    }
  }

  $on(qs('[data-trailer]'), 'click', findTrailer)
</script>
